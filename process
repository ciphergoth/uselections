#!/usr/bin/env python3

import argparse
import pathlib

topdir = pathlib.Path(__file__).parent

import matplotlib.pyplot as plt

import csvdict

def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument('--data', type=pathlib.Path, default=(topdir / "data"))
    return parser.parse_args()

def main():
    args = parse_args()
    receipts = {}
    for d in csvdict.csv_dict(args.data / "totals-2020-09-20T07_40_42.csv", {'receipts': float}):
        if d['party'] == "REP":
            continue
        state = d['state']
        receipts[state] = max(receipts.get(state, 0), d['receipts'])
    fig = plt.figure()
    ax = fig.add_subplot(1,1,1)
    ax.autoscale(False)
    ax.set_xbound([0, 1])
    ax.set_ybound([0, 1.1 * max(receipts.values())/1E6])
    ax.set_title("Senate seats, neglectedness and tractability")
    ax.set_xlabel("538 deluxe model probability of winning seat")
    ax.set_ylabel("FEC receipts by top non-GOP candidate ($M)")
    done = set()
    for d in csvdict.csv_dict(args.data / "election-forecasts-2020" / "senate_state_toplines_2020.csv", {'winner_Dparty': float}):
        if d['expression'] != '_deluxe':
            continue
        if d['district'] in done:
            continue
        done.add(d['district'])
        state = d['district'][:2]
        ax.text(d['winner_Dparty'], receipts[state]/1E6, state,
            ha="center", va="center")
    plt.show()

if __name__ == "__main__":
    main()